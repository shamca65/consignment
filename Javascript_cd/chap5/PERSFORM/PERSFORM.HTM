<html><head>
<title>Form that remembers your PERSONAL data.</title>

<script language="javascript">

<!-- begin script

//////// JavaScript to save Personal Form data for recall on next use. //////

//////  3-Mar-1996 Copyright (C) 1996 by Geoff Inglis. You may use these
//////  routines in your pages (commercial or noncommercial) as long as
//////  you include these four lines. You may not Re-sell this code. 
//////  Questions (or if you use this code) email: inglis@axsnet.com 


//\/\/\/\/\/\/\/\/\  ** Here is the CookieName */\/\/\/\/\/\/\

TheCookieName = 'BigCookieinthesky';
numDays       = 183;  //Days 'till Cookie expires.(eg. 183 days = 6 months)

//** Edit this function to add form entries:
// Add one line like this for each form entry you wish to save in a Cookie
// WholeCookie = WholeCookie + '`' + checknull(document.TestForm.Entry2.value);
//                                                               ||||||
// Entry2 (above) should be replaced by the "name value" for each form item.   
// Note that each form TYPE has a slightly different method. In my
// Next version (depending on Netscape 3.0's javascript), I will automatically
// test the TYPE and do the correct thing. At that time editing this routine
// for your OWN form should be made MUCH easier!!! 3.0 has FORM TYPE. Yea!

// Write One Big Cookie with all the values in it.
function WriteOneBigCookie () {
   var expire = new Date ();
   expire.setTime (expire.getTime() + (numDays * 24 * 3600000)); //6 months from now!
//                                     (dd) (hr) (ms in hr)
   var WholeCookie = expire ;

//Text entry
   WholeCookie = WholeCookie + '`' + checknull(document.TestForm.Entry1.value);
   WholeCookie = WholeCookie + '`' + checknull(document.TestForm.Entry2.value);
   WholeCookie = WholeCookie + '`' + checknull(document.TestForm.Entry2b.value);
   WholeCookie = WholeCookie + '`' + checknull(document.TestForm.Entry2c.value);
   WholeCookie = WholeCookie + '`' + checknull(document.TestForm.Emailadd.value);

//CheckBoxes
   WholeCookie = WholeCookie + '`' + document.TestForm.Entry4.checked;
   WholeCookie = WholeCookie + '`' + document.TestForm.Entry5.checked;
   WholeCookie = WholeCookie + '`' + document.TestForm.Entry6.checked;
   WholeCookie = WholeCookie + '`' + document.TestForm.Entry7.checked;

//Radio button
   WholeCookie = WholeCookie + '`' + setChkIndx(document.TestForm.Entry8);

//Select Form (One entry)
   WholeCookie = WholeCookie + '`' + document.TestForm.Entry9.selectedIndex;

//Select Form (Multiple entries)
   WholeCookie = WholeCookie + '`' + findChkIndx_MS(document.TestForm.Entry10);

//Textarea
   WholeCookie = WholeCookie + '`' + checknull(document.TestForm.Entry11.value);

//Put cookie in the Oven Bake 'till done.
  document.cookie = TheCookieName +"=" + escape (WholeCookie) +
                    "; expires=" + expire.toGMTString() ;

// alert('Your Personal information has been stored, ready for the next time you use this page.');
}

//**Edit this function for each corresponding function above.
//  They are numbered in the order they are placed in the Cookie
//  starting with zero which is ALWAYS the expriation date.

function UpdateForm () {


//Get the Cookievalue then use a Cookie Cutter (parseCookie) to slice it up.
TheCookieValue =  GetCookie(TheCookieName);

//FORM action 
//  document.TestForm.action = 'mailto:inglis@axsnet.com,' + parseCookie(TheCookieValue,5);
    document.TestForm.action = 
        'mailto:test@envmed.rochester.edu,' 
        + document.TestForm.Emailadd.value 
        + '?Subject=JavaScript Cookie Form';

//TEXT input Form
  document.TestForm.ExpDate.value  = parseCookie(TheCookieValue,0);

  document.TestForm.Entry1.value   = parseCookie(TheCookieValue,1);
  document.TestForm.Entry2.value   = parseCookie(TheCookieValue,2);
  document.TestForm.Entry2b.value  = parseCookie(TheCookieValue,3);
  document.TestForm.Entry2c.value  = parseCookie(TheCookieValue,4);
  document.TestForm.Emailadd.value = parseCookie(TheCookieValue,5);

//CheckBoxes
  document.TestForm.Entry4.checked = (parseCookie(TheCookieValue,6)=='true')? true:false ;
  document.TestForm.Entry5.checked = (parseCookie(TheCookieValue,7)=='true')? true:false ;
  document.TestForm.Entry6.checked = (parseCookie(TheCookieValue,8)=='true')? true:false ;
  document.TestForm.Entry7.checked = (parseCookie(TheCookieValue,9)=='true')? true:false ;

//RadioButton
  if (parseCookie(TheCookieValue,10) != "*" )  
        document.TestForm.Entry8[parseCookie(TheCookieValue,10)].checked = true;

//Select Form (One entry)
  if (parseCookie(TheCookieValue,11) != "*" )  
        document.TestForm.Entry9.selectedIndex = parseCookie(TheCookieValue,11);

//Select Form (Multiple Entries)
     setChkIndx_MS(document.TestForm.Entry10,parseCookie(TheCookieValue,12));

//Textarea
  document.TestForm.Entry11.value = parseCookie(TheCookieValue,13);
}

//If user enters nothing then put back the *.
function checknull(theEntry) { //In case the user left it blank!
 if (theEntry == "") return "*"; 
 return theEntry; 
}

//Get and return the index of THE checked radio button
 function setChkIndx(theName) { 
   for (var i=0; i < theName.length; i++ ) {
   if (theName[i].checked == true) return i; 
   }
 return "*"; // One item is always supposed to be checked but... 
 }

//Find and return list of indexes of *all* the selected MULTIPLE selects. YUCK.
//Return list of indexes, seperated by ",".
 function findChkIndx_MS(theName) { 
 var indxlist = "";
   for (var i=0; i < theName.options.length; i++ ) {
   if (theName.options[i].selected == true) indxlist = indxlist + "," + i; 
   }
 return (indxlist == "")?indxlist = "*":indxlist;
 }

//Use the list to SET all stored MULTIPLE selects.
// Most efficient storage for a very long list, but messy.
// Requires clearing all before loading to get only those checked.
 function setChkIndx_MS(formObj,theList) {
   for (var i=0; i < formObj.options.length; i++) { 
   formObj.options[i].selected = false;} //clear all.
   var ilen = 0;
   while ( ilen < theList.length-1 ) { 
    var indxstart = theList.indexOf(',',ilen);
    if (indxstart == -1) return;

    ilen = theList.indexOf(',',indxstart+1);
    if (ilen == -1) ilen = theList.length;

    //make sure its an integer before using as subscript
    var indx = parseInt(theList.substring(indxstart+1,ilen) ,10);
    formObj.options[indx].selected = true;
   }
 }

//Get the cookie from a list of possible cookies. Honest!
function GetCookie (CookieName) {
  var cname = CookieName + "=";
  var i = 0;
  while (i < document.cookie.length) {
    var j = i + cname.length;
    if (document.cookie.substring(i, j) == cname){
        var leng = document.cookie.indexOf (";", j);
        if (leng == -1) leng = document.cookie.length;
        return unescape(document.cookie.substring(j, leng));
    }
    i = document.cookie.indexOf(" ", i) + 1;
    if (i == 0) break; //thats -1 plus 1, duh.
  }
  return "*";
}

//Set the Cookie with expire date in the past - 2 days to get it for sure.
function DelEatCookie (name) {
  var expire = new Date();
  expire.setTime (expire.getTime() - 2 * 86400001);  //-2 days ago. Stale Cookie
  document.cookie = name + "=*; expires=" + expire.toGMTString();
}

//Parse Big  Cookie. A CookieCutter if you will.
function parseCookie(cookieValue, citem) {
   var indx = 0, citemlen =0;
   if ( cookieValue == null ) return "*"//Data has expired or never entered.
   if ( cookieValue == "*"  ) return "*"//Data has expired or never entered.
   for(var i=0; i < citem; i++) {
       indx = ( citem==0 )?0:cookieValue.indexOf("`", indx + 1)+1;}
       citemlen=(cookieValue.indexOf("`",indx)>0)
            ?cookieValue.indexOf("`", indx+1):cookieValue.length;
   return cookieValue.substring(indx, citemlen);
}

// end script -->

</script>
</head>

<body bgcolor="b9edff" onLoad="UpdateForm()">

<CENTER>
<!-- <FORM METHOD="post" ACTION=" " NAME="TestForm" ENCTYPE="text/plain" > 
Above line with ENCTYPE does NOT work on any Mac version. Sigh. -->
<FORM METHOD="post" ACTION=" " NAME="TestForm" >

<TABLE Border="10">

<TR><TH colspan="2" align="center">
A Form to Remember! <BR>
A Library book order form that remembers your personal information.
</TH></TR>

<TR><TD align="right" >Enter Name:</TD>
<TD> <input type="text" name="Entry1" size="50" >
</TD></TR>

<TR><TD align="right" >Enter Address:</TD>
<TD><input type="text" name="Entry2" size="50" >
</TD></TR>

<TR><TD align="right" >Enter State:</TD>
<TD><input type="text" name="Entry2b" size="25" >
 &nbsp   Zip:<input type="text" name="Entry2c" size="17" >
</TD></TR>

<TR><TD align="right">Enter Full e-mail:</TD>
<TD align="center"> <input type="text" name="Emailadd" size="50" >
</TD></TR>

<TR><TD align="center">Enter all interests that apply:<BR> 
<input type="checkbox" name="Entry4" value="sports">* Sports 
<input type="checkbox" name="Entry6" value="books">* Reading <BR>
<input type="checkbox" name="Entry5" value="computers">* Computers 
<input type="checkbox" name="Entry7" value="other">* Other </TD>
<TD align="center">Enter your favorite news source: 
(<input type="radio" name="Entry8" value="None" CHECKED onClick=0> None)  <BR>
 <input type="radio" name="Entry8" value="Radio" onClick=0>* Radio  
 <input type="radio" name="Entry8" value="Television" onClick=0>* Television
 <input type="radio" name="Entry8" value="Newspaper" onClick=0>* Newspaper
 <input type="radio" name="Entry8" value="Internet" onClick=0>* Internet
</TD></TR>

<TR><TD align="right">
Enter all your favorite authors:<BR>
&<BR>

Enter your preferred genre:
</TD>

<TD align="center"><SELECT name="Entry10" Size="3"  MULTIPLE>
<OPTION>Melville
<OPTION>Fitzgerald
<OPTION>Dickens
<OPTION>Wells
<OPTION>Tolstoy
<OPTION>Cooper
<OPTION>McCarthy
<OPTION>Vonnegurt
<OPTION>Updike
<OPTION>Smiley
<OPTION>Chekhov
<OPTION>Oates
</SELECT>* &nbsp   


<SELECT name="Entry9">
<OPTION>Roman á Clef
<OPTION>Anti-novel
<OPTION>Science Fiction
<OPTION>Mystery
<OPTION>Historical Novel
<OPTION>Saga
<OPTION>Short Story
<OPTION>Fable
<OPTION>Biography
</SELECT>*
</TD></TR>

<TR><TD align="center">Tell us about your interests:<BR>
<TEXTAREA name="Entry11" ROWS=3 COLS=25>
</TEXTAREA></TD>
<TD align="center">Enter Book order: (Title, Author, anything you know)<BR>
<TEXTAREA name="Entry11a" ROWS=3 COLS=40>
</TEXTAREA>
</TD></TR>

<TR><TD align="left">Settings will expire on: <BR>
 <input type="text" name="ExpDate" size="28" >
<BR>(Do NOT edit.) Field set by Form.</TD>

<TD align="center">
Submit this form. (Save fields & E-mail to address above):<BR>
<input type="submit" 
value=" PRESS HERE to Order Book NOW. "
        onClick="
        document.TestForm.action = 
        'mailto:test@envmed.rochester.edu,' 
        + document.TestForm.Emailadd.value 
        + '?Subject=JavaScript Cookie Form';
        WriteOneBigCookie();
        UpdateForm();
//This doesn't work with a mailto ACTION        document.TestForm.submit();
        ">
</TD></TR>
</TABLE><BR>

<TABLE BORDER="10">

<TR><TH align="center" colspan="2" > Maintenance Functions 
(Not all needed for most forms).<BR>
Provided for instruction and playing.</TH></TR>

<TR><TD align="center"> 
<input type="button" value="SAVE Changes and/or Set New Expiration"
        onClick="
        WriteOneBigCookie();
        UpdateForm();
        ">

</TD><TD align="center">
<input type="button" value="DELETE ALL stored values, & Clear form" 
        onClick="
        if (confirm('Do you REALLY want to Delete all your saved Fields?')) {
        DelEatCookie(TheCookieName);
//The next line only works If you have included a RESET TYPE button.
  document.TestForm.EntryReset.click(); //Edit to the RESET button NAME!
        UpdateForm();}
        ">
</TD></TR>

<TR><TD align="center">
<input type="reset" name="EntryReset"  
       value="CLEAR current form, but NOT stored Values"></TD>

<TD align="center">
<input type="button" value="RECALL stored values" 
        onClick="
        UpdateForm();
        ">
</TD></TR>
</TABLE></FORM>
</CENTER>

</body>
</html>

